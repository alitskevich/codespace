<components>
  <component id="Page.AddText">
    <BrowserService Ref="browser" title="{R.name}" />
    <UploaderService Ref="uploader" acquired="<-db.allAcquired|arrayToObject" />
    <Header />

    <Connector data="{R.samples.text1}" change="data-> uploader.uploadText(data)" />

    <!-- <Connector data="<-uploader.word" change="-> value" /> -->

    <Container class="w-full h-full grid grid-cols-3 p-4 gap-4 pt-[6rem]">
      <div class="col-span-3">
        <MarkedText data="<-uploader.parsedText" class="flex-1 overflow-y-auto !text-xl" />
      </div>
      <div class="{R.styles.card} overflow-y-auto ">
        <div class="flex items-start flex-wrap text-2xl gap-2">
          <Word Each="item of <-uploader.list|filter:'acquired':-1" item="{item}" />
        </div>
      </div>
      <div class="{R.styles.card} overflow-y-auto ">
        <div class="flex items-start flex-wrap text-2xl gap-2">
          <Word Each="item of <-uploader.list|filter:'acquired':0" item="{item}" />
        </div>
      </div>
      <div class="{R.styles.card} overflow-y-auto ">
        <div class="flex items-start flex-wrap text-2xl gap-2">
          <Word Each="item of <-uploader.list|filter:'acquired':1" item="{item}" />
        </div>
      </div>
    </Container>

    <AddText />
  </component>

  <component id="Word">
    <div class="relative inline-block mb-2" click="-> expanded=true">
      <span data="{item}" class="border-dotted border hover:border-gray-500 p-1 
          leading-8 rounded-md bg-neutral-200
          cursor-pointer
          {item.type == 'word' ? 'word' :''} word-{item.acquired} text-{item.acquired|toColorText}-700">{item.name}
      </span>
      <Tooltip data="{item}" If="expanded" close="-> expanded=false" />
    </div>
  </component>


  <component id="AddText">

    <StoredData Ref="text" defaults="{R.samples.text1}" />

    <Connector trigger="{counter}" data="<-text.value" change="data-> uploader.uploadText(data)" />
    <Connector trigger="{counter}" change="-> opened=false" />

    <StoredData Ref="fromClipboard" defaults="<-browser.fromClipboard" persistence="inmemory" />

    <FAB class="select-none" mode="primary" title="+" action="-> opened=true" />
    <Modal open="{opened}" If="opened" close="-> opened=false" class="top-12">
      <Modal:header>
        <div class="flex justify-between items-center w-full pr-4">
          <h3 class="text-xl font-semibold text-sky-500">Input a new text</h3>
          <Btn title="Paste" action="-> text.value=fromClipboard.value" />
        </div>
      </Modal:header>
      <div>
        <textarea autofocus class="input px-2 w-full" style="min-height:16rem;" change="-> text.value=data.value"
          value="<-text.value"></textarea>
      </div>
      <Modal:footer>
        <div class="flex justify-between w-full">
          <FieldHint class="mt-4 flex-1" value="{hint}" />
          <Btn class="" mode="primary" title="OK" action="-> counter = counter ?? 0 | increment" />
        </div>
      </Modal:footer>
    </Modal>
  </component>

</components>